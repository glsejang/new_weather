@use "sass:map";

/* =========================================================================
   Todos Page Styles
   - 리스트형(스크롤 가능)
   - 날씨별 테마 + va~vf 변형
   - compact / ultra 모드로 작은 카드
=========================================================================== */

.todo-grid {
  --gap: 14px;
  --padX: var(--space-4);
  --padY: 18px;
  --radius-card: var(--radius-lg);

  min-height: 100dvh;
  background: var(--bg);
  padding: var(--padY) var(--padX);
  color: var(--text);

  display: flex;
  flex-direction: column;
  gap: var(--gap);

  .empty {
    padding: 24px;
    border-radius: var(--radius-card);
    border: 1px dashed var(--border);
    color: var(--muted);
    text-align: center;
    background: #fff;
  }
}

/* ========================= 카드 (tcard) ========================= */
.tcard {
  position: relative;
  overflow: hidden;
  padding: 20px;
  border-radius: var(--radius-card);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-md);

  /* 테마 기본값 */
  --g1: #f9fafb;
  --g2: #eef1f5;
  --accent: #ff9f65;
  --ink: #111218;
  --ink-soft: rgba(17,18,24,.65);
  --chip-bg: rgba(255,255,255,.92);
  --chip-border: rgba(255,255,255,.45);

  background: linear-gradient(180deg, var(--g1), var(--g2));
  color: var(--ink);

  /* 사선 하이라이트 */
  &::before {
    content: "";
    position: absolute; inset: 0;
    background:
      linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,0) 38%),
      radial-gradient(130% 90% at 50% -10%, rgba(255,255,255,.16), transparent 60%);
    pointer-events: none;
    mix-blend-mode: soft-light;
  }

  /* 헤더 */
  .thead {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 10px;

    .tdate {
      font-weight: 800;
      font-size: clamp(16px, 4.4vw, 20px);
      line-height: 1.1;
    }
    .tmeta {
      display: inline-flex;
      align-items: center;
      gap: 8px;

      .tpct {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 44px;
        height: 28px;
        padding: 0 10px;
        border-radius: 999px;
        background: var(--chip-bg);
        border: 1px solid var(--chip-border);
        box-shadow: var(--shadow-sm);
        font-weight: 800;
        font-size: var(--fz-xs);
        color: var(--ink);
      }
    }
  }

  /* 진행 바 (JSX에서 --val: 0~100 숫자) */
  .tmeter {
    height: 8px;
    border-radius: 999px;
    background: rgba(255,255,255,.45);
    border: 1px solid var(--chip-border);
    overflow: hidden;
    position: relative;
    margin-bottom: 12px;

    i {
      content: "";
      position: absolute; inset: 0;
      width: calc(var(--val, 0) * 1%); /* ← 숫자 → % */
      background: linear-gradient(
        90deg,
        color-mix(in oklab, var(--accent) 86%, white 14%),
        var(--accent)
      );
    }
  }

  /* 상단 경고칩 */
  .tchips {
    display: flex; flex-wrap: wrap;
    gap: 8px; margin-bottom: 12px;

    .chip {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 12px;
      border-radius: 999px;
      background: var(--chip-bg);
      border: 1px solid var(--chip-border);
      box-shadow: var(--shadow-sm);
      font-size: var(--fz-xs);
      color: var(--ink);

      &.glass { backdrop-filter: blur(6px); }
      &.danger {
        border-color: color-mix(in oklab, #ff4d4f 40%, var(--chip-border) 60%);
        background: color-mix(in oklab, #ffecec 60%, var(--chip-bg) 40%);
        color: #7a1012;
      }
    }
  }

  /* 내용 패널 */
  .tcontent {
    border-radius: 16px;
    background: rgba(255,255,255,.94);
    border: 1px solid rgba(0,0,0,.05);
    box-shadow: var(--shadow-sm);
    padding: 14px;

    .tasks { display: grid; gap: 12px; }

    .task {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      padding: 10px 12px;

      .plant {
        font-weight: 800;
        font-size: clamp(14px, 3.8vw, 16px);
        margin-bottom: 8px;
        color: var(--text);
      }

      ul { list-style: none; margin: 0; padding: 0; & + ul { margin-top: 6px; } }

      li {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 10px;
        border: 1px solid transparent;
        background: #fff;
        cursor: pointer;
        transition: .18s ease;

        &::before {
          content: "";
          flex: 0 0 18px;
          height: 18px;
          border-radius: 4px;
          border: 1.5px solid var(--border);
          background: #fff;
          margin-top: 2px;
          box-shadow: inset 0 1px 0 rgba(0,0,0,.03);
        }

        &:hover { background: #fafafa; }
        &:focus { outline: none; }
        &:focus-visible {
          box-shadow: 0 0 0 3px rgba(88,114,255,.28);
          border-color: rgba(88,114,255,.4);
        }

        &.done {
          color: var(--muted);
          text-decoration: line-through;
          background: #f8f9fb;
          border-color: #e8ebef;

          &::before {
            background: linear-gradient(180deg, #8bc34a, #4caf50);
            border-color: #4caf50;
            box-shadow: inset 0 0 0 2px rgba(255,255,255,.9);
          }
        }
      }
    }
  }
}

/* ========================= 날씨별 테마 ========================= */
.tcard.sunny, .tcard.warm {
  --g1: #ffcc73;
  --g2: #ff9b54;
  --accent: #ffc069;
  --ink: #1f1208;
  --ink-soft: rgba(31,18,8,.7);
  --chip-bg: rgba(255,255,255,.92);
  --chip-border: rgba(255,255,255,.45);
}
.tcard.cloudy {
  --g1: #9aa1a9;
  --g2: #5e6670;
  --accent: #cfd6de;
  --ink: #ffffff;
  --ink-soft: rgba(255,255,255,.85);
  --chip-bg: rgba(255,255,255,.15);
  --chip-border: rgba(255,255,255,.25);
}
.tcard.rain {
  --g1: #4ec7a4;
  --g2: #2f9f8b;
  --accent: #b7ffe7;
  --ink: #0e1a14;
  --ink-soft: rgba(14,26,20,.7);
  --chip-bg: rgba(255,255,255,.9);
  --chip-border: rgba(255,255,255,.45);
}
.tcard.thunder {
  --g1: #7166ff;
  --g2: #6631c7;
  --accent: #c7b8ff;
  --ink: #ffffff;
  --ink-soft: rgba(255,255,255,.85);
  --chip-bg: rgba(255,255,255,.14);
  --chip-border: rgba(255,255,255,.28);
}
.tcard.snow {
  --g1: #cfe9ff;
  --g2: #9dd0ff;
  --accent: #ffffff;
  --ink: #0d2436;
  --ink-soft: rgba(13,36,54,.7);
  --chip-bg: rgba(255,255,255,.92);
  --chip-border: rgba(255,255,255,.5);
}
.tcard.sunset {
  --g1: #ff9a7b;
  --g2: #ff6b6b;
  --accent: #ffd0c3;
  --ink: #2a0e0c;
  --ink-soft: rgba(42,14,12,.7);
  --chip-bg: rgba(255,255,255,.9);
  --chip-border: rgba(255,255,255,.45);
}
.tcard.haze {
  --g1: #d9d2c4;
  --g2: #c3b9a8;
  --accent: #f3efe8;
  --ink: #26231d;
  --ink-soft: rgba(38,35,29,.7);
  --chip-bg: rgba(255,255,255,.88);
  --chip-border: rgba(255,255,255,.45);
}

/* ========================= 변형 시스템(va~vf) ========================= */
.tcard {
  --variant-strength: 0%;
  --variant-tint: transparent;

  background: linear-gradient(
    180deg,
    color-mix(in oklab, var(--g1) calc(100% - var(--variant-strength)),
                      var(--variant-tint) var(--variant-strength)),
    color-mix(in oklab, var(--g2) calc(100% - var(--variant-strength)),
                      var(--variant-tint) var(--variant-strength))
  );

  /* 진행바 포인트도 변형 반영 */
  --accent: color-mix(in oklab, var(--accent) 78%, var(--variant-tint) 22%);
}

.tcard.va { --variant-strength: 22%; --variant-tint: #ffcf5a; }
.tcard.vb { --variant-strength: 24%; --variant-tint: #7fd6ff; }
.tcard.vc { --variant-strength: 22%; --variant-tint: #7de0be; }
.tcard.vd { --variant-strength: 26%; --variant-tint: #a596ff; }
.tcard.ve { --variant-strength: 28%; --variant-tint: #ff9aa6; }
.tcard.vf { --variant-strength: 20%; --variant-tint: #ffd4ff; }

.tcard.sunny.va, .tcard.warm.va { --variant-tint: #ffbe55; --variant-strength: 26%; }
.tcard.sunny.ve, .tcard.warm.ve { --variant-tint: #ff8ea0; --variant-strength: 24%; }
.tcard.sunny.vf, .tcard.warm.vf { --variant-tint: #ffd6b3; --variant-strength: 20%; }

.tcard.rain.vb { --variant-tint: #6cc8ff; --variant-strength: 26%; }
.tcard.rain.vc { --variant-tint: #70e6c8; --variant-strength: 24%; }
.tcard.rain.vd { --variant-tint: #8fb0ff; --variant-strength: 22%; }

.tcard.snow.vb { --variant-tint: #9fdcff; --variant-strength: 24%; }
.tcard.snow.vd { --variant-tint: #b6adff; --variant-strength: 22%; }
.tcard.snow.vf { --variant-tint: #e6f0ff; --variant-strength: 18%; }

.tcard.cloudy.vb { --variant-tint: #83b3d9; --variant-strength: 24%; }
.tcard.cloudy.vd { --variant-tint: #a59be6; --variant-strength: 22%; }
.tcard.cloudy.ve { --variant-tint: #d8a0a9; --variant-strength: 20%; }

/* ========================= Compact & Ultra ========================= */
.todo-grid.compact {
  --gap: 10px;
  --padY: 12px;

  .tcard { padding: 12px 14px; border-radius: 14px; }
  .tcard .thead { margin-bottom: 6px; gap: 8px; }
  .tcard .thead .tdate { font-size: clamp(14px, 3.8vw, 16px); line-height: 1.05; }
  .tcard .thead .tpct { min-width: 38px; height: 24px; padding: 0 8px; font-size: 11px; }
  .tcard .tmeter { height: 6px; margin-bottom: 8px; }
  .tcard .tchips { gap: 6px; margin-bottom: 8px; }
  .tcard .tchips .chip { padding: 6px 10px; font-size: 11px; }
  .tcard .tcontent { padding: 10px; border-radius: 12px; }
  .tcard .tasks { gap: 8px; }
  .tcard .task { padding: 8px 10px; border-radius: 10px; }
  .tcard .task .plant { font-size: clamp(13px, 3.4vw, 14px); margin-bottom: 6px; }
  .tcard .task ul + ul { margin-top: 4px; }
  .tcard .task li { padding: 6px 8px; border-radius: 8px; gap: 8px; }
  .tcard .task li::before { flex: 0 0 16px; height: 16px; border-radius: 4px; }
}

/* 초컴팩트 */
.todo-grid.compact.ultra {
  --gap: 8px;
  --padY: 8px;

  .tcard { padding: 10px 12px; border-radius: 12px; }
  .tcard .thead { margin-bottom: 4px; gap: 6px; }
  .tcard .thead .tdate { font-size: clamp(13px, 3.4vw, 14px); }
  .tcard .thead .tpct  { min-width: 34px; height: 22px; padding: 0 6px; font-size: 10px; }
  .tcard .tmeter { height: 5px; margin-bottom: 6px; }
  .tcard .tchips { gap: 4px; margin-bottom: 6px; }
  .tcard .tchips .chip { padding: 4px 8px; font-size: 10px; }
  .tcard .tcontent { padding: 8px; border-radius: 10px; }
  .tcard .tasks { gap: 6px; }
  .tcard .task { padding: 6px 8px; border-radius: 8px; }
  .tcard .task .plant { font-size: 12px; margin-bottom: 4px; }
  .tcard .task li { padding: 5px 6px; gap: 6px; border-radius: 6px; }
  .tcard .task li::before { flex: 0 0 14px; height: 14px; border-radius: 3px; }
}

/* 반응형 */
@media (max-width: 360px) {
  .todo-grid { --gap: 10px; --padY: 12px; }
  .tcard { padding: 16px; }
  .tcard .tcontent { padding: 12px; }

  .todo-grid.compact .tcard { padding: 10px 12px; }
  .todo-grid.compact .tcard .tcontent { padding: 8px; }
}

/* 포커스 가시성 */
:where(.tcard [tabindex="0"]):focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(88,114,255,.28), inset 0 0 0 1px rgba(88,114,255,.5);
  border-color: rgba(88,114,255,.5);
}
